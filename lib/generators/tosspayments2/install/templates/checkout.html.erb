<h1>결제 진행</h1>

<%% if @payment %>
<div class="payment-info">
  <h3>결제 정보</h3>
  <p><strong>주문번호:</strong> <%%= @payment.order_id %></p>
  <p><strong>결제금액:</strong> <%%= @payment.formatted_amount %></p>
</div>

<!-- TossPayments 결제 위젯 영역 -->
<div data-controller="tosspayments-checkout"
     data-tosspayments-checkout-client-key-value="<%%= Rails.application.credentials.dig(:tosspayments, :client_key) || ENV['TOSSPAYMENTS_CLIENT_KEY'] %>"
     data-tosspayments-checkout-customer-key-value="customer_<%%= Time.current.to_i %>"
     data-tosspayments-checkout-order-id-value="<%%= @payment.order_id %>"
     data-tosspayments-checkout-order-name-value="결제 테스트 상품"
     data-tosspayments-checkout-customer-name-value="고객"
     data-tosspayments-checkout-amount-value="<%%= @payment.amount %>"
     data-tosspayments-checkout-success-url-value="<%%= success_payments_url %>"
     data-tosspayments-checkout-fail-url-value="<%%= fail_payments_url %>">
  
  <div id="payment-methods" data-tosspayments-checkout-target="paymentMethods"></div>
  <div id="agreement" data-tosspayments-checkout-target="agreement"></div>
  <button data-tosspayments-checkout-target="paymentButton" 
          data-action="click->tosspayments-checkout#requestPayment"
          class="btn btn-primary">결제하기</button>
</div>

<%%= tosspayments_script_tag %>

<%% else %>
<div class="alert alert-danger">
  결제 정보를 찾을 수 없습니다.
</div>
<div class="actions">
  <%%= link_to '목록으로', payments_path, class: 'btn btn-secondary' %>
</div>
<%% end %>

